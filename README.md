# RAG Система для Интернет Магазина

Система ответов на вопросы с использованием Retrieval-Augmented Generation (RAG).

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите OpenAI API ключ:
```bash
# Windows
set OPENAI_API_KEY=your-api-key-here

# Linux/Mac
export OPENAI_API_KEY=your-api-key-here
```

## Файлы

- `main.py` - основная RAG система
- `utils.py` - вспомогательные функции для работы с эмбеддингами и LLM
- `ecommerce_qa.json` - база данных вопросов и ответов (20 записей)
- `vector_db.pkl` - кешированная векторная база (создается автоматически)
- `requirements.txt` - зависимости проекта

## Как работает

1. **Загрузка данных**: Система загружает вопросы и ответы из JSON файла
2. **Проверка кеша**: Проверяется существование сохраненной векторной базы
3. **Создание/загрузка эмбеддингов**: Создаются новые эмбеддинги или загружаются из кеша
4. **Семантический поиск**: Для каждого вопроса находятся наиболее релевантные чанки ответов
5. **Генерация ответа**: LLM генерирует улучшенный ответ на основе найденного контекста

### Кеширование векторной базы

Система автоматически сохраняет созданные эмбеддинги в файл `vector_db.pkl`, что значительно ускоряет повторные запуски программы. При первом запуске создается база эмбеддингов, при последующих запусках она загружается из файла.

## Использование

### Запуск основной программы:
```bash
# Обычный запуск (с использованием кеша)
python main.py

# Принудительное пересоздание векторной базы
python main.py --rebuild
```

Программа сначала протестирует систему на нескольких вопросах, а затем перейдет в интерактивный режим.

**Опции командной строки:**
- `--rebuild` или `-r` - принудительно пересоздает векторную базу (полезно при изменении данных)

### Функции в main.py:

- `load_qa_data(filename)` - загружает данные из JSON
- `check_vector_database_exists(filename)` - проверяет существование векторной базы
- `save_vector_database(text_chunks, embeddings, filename)` - сохраняет векторную базу
- `load_vector_database(filename)` - загружает векторную базу из файла
- `prepare_knowledge_base(qa_data)` - создает базу знаний с эмбеддингами
- `semantic_search_wrapper(query, text_chunks, embeddings)` - находит релевантные чанки
- `rag_answer(question, text_chunks, embeddings)` - генерирует ответ с помощью RAG

## Примеры вопросов

- "Какие способы оплаты доступны?"
- "Сколько времени занимает доставка?"
- "Можно ли вернуть товар?"
- "Есть ли программа лояльности?"

## Технические детали

- **Модель эмбеддингов**: BAAI/bge-en-icl
- **LLM модель**: meta-llama/Llama-3.2-3B-Instruct
- **Размер чанков**: 500 символов с перекрытием 50 символов
- **Количество релевантных чанков**: 3 (топ-3)

## Структура JSON данных

```json
[
  {
    "question": "Вопрос клиента",
    "answer": "Подробный ответ"
  }
]
```

## Требования

- Python 3.8+
- OpenAI API ключ
- numpy >= 1.24.0
- openai >= 1.0.0

## Устранение неполадок

1. **Ошибка API ключа**: Убедитесь что установлен корректный OPENAI_API_KEY
2. **Ошибки импорта**: Установите зависимости `pip install -r requirements.txt`
3. **Проблемы с кодировкой**: Убедитесь что все файлы сохранены в UTF-8 